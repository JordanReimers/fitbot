{"ts":1358959927363,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1358959758025,"patch":[[{"diffs":[[1,"# encoding: utf-8\r\n\r\nclass Youtube\r\n    include Cinch::Plugin\r\n\r\n\tmatch /y(?:outube)? (.+)/i\r\n\tmatch /yt (.+)/i\r\n\r\n\tdef length_in_minutes(seconds)\r\n\t\treturn nil if seconds < 0\r\n\r\n\t\tif seconds > 3599\r\n\t\t\tlength = [seconds/3600, seconds/60 % 60, seconds % 60].map{|t| t.to_s.rjust(2,'0')}.join(':')\r\n\t\telsif seconds > 59\r\n\t\t\tlength = [seconds/60 % 60, seconds % 60].join('m')+\"s\"\r\n\t\telse\r\n\t\t\tlength = length+\"s\"\r\n\t\tend\r\n\tend\r\n\r\n\tdef execute(m, query)\r\n\t\treturn unless ignore_nick(m.user.nick).nil?\r\n\r\n\t\tbegin\r\n\t\t\tbitly = Bitly.new($BITLYUSER, $BITLYAPI)\r\n\r\n\t\t\tquery = URI.escape(query)\r\n\r\n\t\t\t@url = open(\"http://gdata.youtube.com/feeds/api/videos?q=#{query}&max-results=3&v=2&prettyprint=true&alt=rss\")\r\n\t\t\t@url = Nokogiri::XML(@url)\r\n\r\n\t\t\t@page_url = bitly.shorten(\"https://www.youtube.com/results?search_query=#{query}\")\r\n\r\n\t\t\tdef search(number)\r\n\t\t\t\treturn if @url.xpath(\"//item[#{number}]/title\").text.length < 1\r\n\r\n\t\t\t\tname       = @url.xpath(\"//item[#{number}]/title\").text\r\n\t\t\t\tid         = @url.xpath(\"//item[#{number}]/media:group/yt:videoid\").text\r\n\t\t\t\tviews      = @url.xpath(\"//item[#{number}]/yt:statistics/@viewCount\").text\r\n\t\t\t\tlikes      = @url.xpath(\"//item[#{number}]/yt:rating/@numLikes\").text\r\n\t\t\t\tdislikes   = @url.xpath(\"//item[#{number}]/yt:rating/@numDislikes\").text\r\n\t\t\t\trating     = @url.xpath(\"//item[#{number}]/gd:rating/@average\").text\r\n\t\t\t\tlength     = @url.xpath(\"//item[#{number}]/media:group/yt:duration/@seconds\").text\r\n\r\n\t\t\t\tviews      = views.reverse.gsub(%r{([0-9]{3}(?=([0-9])))}, \"\\\\1,\").reverse\r\n\t\t\t\tlikes      = likes.reverse.gsub(%r{([0-9]{3}(?=([0-9])))}, \"\\\\1,\").reverse\r\n\t\t\t\tdislikes   = dislikes.reverse.gsub(%r{([0-9]{3}(?=([0-9])))}, \"\\\\1,\").reverse\r\n\r\n\t\t\t\tlength = length_in_minutes(length.to_i)\r\n\r\n\t\t\t\t\"YouTube \u00034|\u0003 \\\"%s\\\" \u00034|\u0003 %s \u00034|\u0003 %s views \u00034|\u0003 %s/5 (%s|%s) \u00034|\u0003 \u001fhttp://youtu.be/%s\u001f \u00034|\u0003 More results: \u001f%s\u001f\" % [name, length, views, rating[0..2], likes, dislikes, id, @page_url.shorten]\r\n\t\t\tend\r\n\r\n\t\t\tm.reply search(1)\r\n\t\trescue\r\n\t\t\tm.reply \"YouTube \u00034|\u0003 Error: Could not find video\"\r\n\t\tend\r\n\tend\r\nend"]],"start1":0,"start2":0,"length1":0,"length2":2054}]],"length":2054,"saved":false}
