{"ts":1358959763033,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1358959588576,"patch":[[{"diffs":[[1,"# encoding: utf-8\r\n\r\nclass Twitter\r\n    include Cinch::Plugin\r\n\r\n\tmatch /tw(?:itter)? (.+)/i\r\n\r\n\tdef minutes_in_words(timestamp)\r\n\t\tminutes = (((Time.now - timestamp).abs)/60).round\r\n\r\n\t\treturn nil if minutes < 0\r\n\r\n\t\tcase minutes\r\n\t\twhen 0..1      then \"just now\"\r\n\t\twhen 2..59     then \"#{minutes.to_s} minutes ago\"\r\n\t\twhen 60..1439        \r\n\t\t\twords = (minutes/60)\r\n\t\t\tif words > 1\r\n\t\t\t\t\"#{words.to_s} hours ago\"\r\n\t\t\telse\r\n\t\t\t\t\"#{words.to_s} hour ago\"\r\n\t\t\tend\r\n\t\twhen 1440..11519     \r\n\t\t\twords = (minutes/1440)\r\n\t\t\tif words > 1\r\n\t\t\t\t\"#{words.to_s} days ago\"\r\n\t\t\telse\r\n\t\t\t\t\"#{words.to_s} day ago\"\r\n\t\t\tend\r\n\t\twhen 11520..43199    \r\n\t\t\twords = (minutes/11520)\r\n\t\t\tif words > 1\r\n\t\t\t\t\"#{words.to_s} weeks ago\"\r\n\t\t\telse\r\n\t\t\t\t\"#{words.to_s} week ago\"\r\n\t\t\tend\r\n\t\twhen 43200..525599   \r\n\t\t\twords = (minutes/43200)\r\n\t\t\tif words > 1\r\n\t\t\t\t\"#{words.to_s} months ago\"\r\n\t\t\telse\r\n\t\t\t\t\"#{words.to_s} month ago\"\r\n\t\t\tend\r\n\t\telse                      \r\n\t\t\twords = (minutes/525600)\r\n\t\t\tif words > 1\r\n\t\t\t\t\"#{words.to_s} years ago\"\r\n\t\t\telse\r\n\t\t\t\t\"#{words.to_s} year ago\"\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\n\r\n\tdef execute(m, query)\r\n\t\treturn unless ignore_nick(m.user.nick).nil?\r\n\r\n\t\tbegin\r\n\t\t\turl = Nokogiri::XML(open(\"http://api.twitter.com/1/statuses/user_timeline.xml?screen_name=#{query}&count=1&include_rts=true&exclude_replies=true&include_entities=true\", :read_timeout=>3).read)\r\n\r\n\t\t\ttweettext   = url.xpath(\"//status/text\").text.gsub(/\\s+/, ' ')\r\n\t\t\tposted      = url.xpath(\"//status/created_at\").text\r\n\t\t\tname        = url.xpath(\"//statuses/status/user/name\").text\r\n\t\t\tscreenname  = url.xpath(\"//statuses/status/user/screen_name\").text\r\n\r\n\t\t\turls        = url.xpath(\"//status/entities/urls/url\")\r\n\r\n\t\t\turls.each do |rep|\r\n\t\t\t\tshortened   = rep.xpath(\"url\").text\r\n\t\t\t\texpanded    = rep.xpath(\"expanded_url\").text\r\n\t\t\t\ttweettext   = tweettext.gsub(shortened, expanded)\r\n\t\t\tend\r\n\r\n\t\t\ttime        = Time.parse(posted)\r\n\t\t\ttime        = minutes_in_words(time)\r\n\r\n\t\t\tm.reply \"Twitter \u000312|\u0003 \u0002#{name}\u0002 (@#{screenname}) \u000312|\u0003 #{tweettext} \u000312|\u0003 Posted #{time}\"\r\n\t\trescue Timeout::Error\r\n\t\t\tm.reply \"Twitter \u000312|\u0003 Timeout Error. Maybe twitter is down?\"\r\n\t\trescue\r\n\t\t\tm.reply \"Twitter \u000312|\u0003 #{query} \u000312|\u0003 Could not get tweet\"\r\n\t\tend\r\n\tend\r\nend"]],"start1":0,"start2":0,"length1":0,"length2":2211}]],"length":2211,"saved":false}
